
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *  WARNING: Moovweb auto-generated file. Any changes you make here will *
 *  be overwritten.                                                      *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

(function(){

var mapProxyToOrigin = {"http://mlocal.6thfloor.blogs.nytimes.com":"http://6thfloor.blogs.nytimes.com","http://mlocal.artsbeat.blogs.nytimes.com":"http://artsbeat.blogs.nytimes.com","http://mlocal.autos.nytimes.com":"http://autos.nytimes.com","http://mlocal.beta620.nytimes.com":"http://beta620.nytimes.com","http://mlocal.bits.blogs.nytimes.com":"http://bits.blogs.nytimes.com","http://mlocal.dealbook.nytimes.com":"http://dealbook.nytimes.com","http://mlocal.dotearth.blogs.nytimes.com":"http://dotearth.blogs.nytimes.com","http://mlocal.eedition.nytimes.com":"http://eedition.nytimes.com","http://mlocal.frugaltraveler.blogs.nytimes.com":"http://frugaltraveler.blogs.nytimes.com","http://mlocal.gadgetwise.blogs.nytimes.com":"http://gadgetwise.blogs.nytimes.com","http://mlocal.global.nytimes.com":"http://global.nytimes.com","http://mlocal.graphics8.nytimes.com":"http://graphics8.nytimes.com","http://mlocal.homedelivery.nytimes.com":"http://homedelivery.nytimes.com","http://mlocal.jobmarket.nytimes.com":"http://jobmarket.nytimes.com","http://mlocal.json8.nytimes.com":"http://json8.nytimes.com","http://mlocal.krugman.blogs.nytimes.com":"http://krugman.blogs.nytimes.com","http://mlocal.latitude.blogs.nytimes.com":"http://latitude.blogs.nytimes.com","http://mlocal.lens.blogs.nytimes.com":"http://lens.blogs.nytimes.com","http://mlocal.listings.nytimes.com":"http://listings.nytimes.com","http://mlocal.markets.on.nytimes.com":"http://markets.on.nytimes.com","http://mlocal.mobile.nytimes.com":"http://mobile.nytimes.com","http://mlocal.movies.nytimes.com":"http://movies.nytimes.com","http://mlocal.myaccount.nytimes.com":"http://myaccount.nytimes.com","http://mlocal.nocera.blogs.nytimes.com":"http://nocera.blogs.nytimes.com","http://mlocal.nytimes.com":"http://www.nytimes.com","http://mlocal.offthedribble.blogs.nytimes.com":"http://offthedribble.blogs.nytimes.com","http://mlocal.opinionator.blogs.nytimes.com":"http://opinionator.blogs.nytimes.com","http://mlocal.placead.nytimes.com":"http://placead.nytimes.com","http://mlocal.publiceditor.blogs.nytimes.com":"http://publiceditor.blogs.nytimes.com","http://mlocal.realestate.nytimes.com":"http://realestate.nytimes.com","http://mlocal.realestateads.nytimes.com":"http://realestateads.nytimes.com","http://mlocal.spiderbites.nytimes.com":"http://spiderbites.nytimes.com","http://mlocal.takingnote.blogs.nytimes.com":"http://takingnote.blogs.nytimes.com","http://mlocal.theater.nytimes.com":"http://theater.nytimes.com","http://mlocal.thecaucus.blogs.nytimes.com":"http://thecaucus.blogs.nytimes.com","http://mlocal.thelede.blogs.nytimes.com":"http://thelede.blogs.nytimes.com","http://mlocal.timeslimited.nytimes.com":"http://timeslimited.nytimes.com","http://mlocal.timesmachine.nytimes.com":"http://timesmachine.nytimes.com","http://mlocal.tmagazine.blogs.nytimes.com":"http://tmagazine.blogs.nytimes.com","http://mlocal.travel.nytimes.com":"http://travel.nytimes.com","http://mlocal.up.nytimes.com":"http://up.nytimes.com","http://mlocal.video.nytimes.com":"http://video.nytimes.com","http://mlocal.well.blogs.nytimes.com":"http://well.blogs.nytimes.com","http://mlocal.wordplay.blogs.nytimes.com":"http://wordplay.blogs.nytimes.com","http://mlocal.wt.o.nytimes.com":"http://wt.o.nytimes.com","https://mlocal.6thfloor.blogs.nytimes.com":"https://6thfloor.blogs.nytimes.com","https://mlocal.artsbeat.blogs.nytimes.com":"https://artsbeat.blogs.nytimes.com","https://mlocal.autos.nytimes.com":"https://autos.nytimes.com","https://mlocal.beta620.nytimes.com":"https://beta620.nytimes.com","https://mlocal.bits.blogs.nytimes.com":"https://bits.blogs.nytimes.com","https://mlocal.dealbook.nytimes.com":"https://dealbook.nytimes.com","https://mlocal.dotearth.blogs.nytimes.com":"https://dotearth.blogs.nytimes.com","https://mlocal.eedition.nytimes.com":"https://eedition.nytimes.com","https://mlocal.frugaltraveler.blogs.nytimes.com":"https://frugaltraveler.blogs.nytimes.com","https://mlocal.gadgetwise.blogs.nytimes.com":"https://gadgetwise.blogs.nytimes.com","https://mlocal.global.nytimes.com":"https://global.nytimes.com","https://mlocal.graphics8.nytimes.com":"https://graphics8.nytimes.com","https://mlocal.homedelivery.nytimes.com":"https://homedelivery.nytimes.com","https://mlocal.jobmarket.nytimes.com":"https://jobmarket.nytimes.com","https://mlocal.json8.nytimes.com":"https://json8.nytimes.com","https://mlocal.krugman.blogs.nytimes.com":"https://krugman.blogs.nytimes.com","https://mlocal.latitude.blogs.nytimes.com":"https://latitude.blogs.nytimes.com","https://mlocal.lens.blogs.nytimes.com":"https://lens.blogs.nytimes.com","https://mlocal.listings.nytimes.com":"https://listings.nytimes.com","https://mlocal.markets.on.nytimes.com":"https://markets.on.nytimes.com","https://mlocal.mobile.nytimes.com":"https://mobile.nytimes.com","https://mlocal.movies.nytimes.com":"https://movies.nytimes.com","https://mlocal.myaccount.nytimes.com":"https://myaccount.nytimes.com","https://mlocal.nocera.blogs.nytimes.com":"https://nocera.blogs.nytimes.com","https://mlocal.nytimes.com":"https://www.nytimes.com","https://mlocal.offthedribble.blogs.nytimes.com":"https://offthedribble.blogs.nytimes.com","https://mlocal.opinionator.blogs.nytimes.com":"https://opinionator.blogs.nytimes.com","https://mlocal.placead.nytimes.com":"https://placead.nytimes.com","https://mlocal.publiceditor.blogs.nytimes.com":"https://publiceditor.blogs.nytimes.com","https://mlocal.realestate.nytimes.com":"https://realestate.nytimes.com","https://mlocal.realestateads.nytimes.com":"https://realestateads.nytimes.com","https://mlocal.spiderbites.nytimes.com":"https://spiderbites.nytimes.com","https://mlocal.takingnote.blogs.nytimes.com":"https://takingnote.blogs.nytimes.com","https://mlocal.theater.nytimes.com":"https://theater.nytimes.com","https://mlocal.thecaucus.blogs.nytimes.com":"https://thecaucus.blogs.nytimes.com","https://mlocal.thelede.blogs.nytimes.com":"https://thelede.blogs.nytimes.com","https://mlocal.timeslimited.nytimes.com":"https://timeslimited.nytimes.com","https://mlocal.timesmachine.nytimes.com":"https://timesmachine.nytimes.com","https://mlocal.tmagazine.blogs.nytimes.com":"https://tmagazine.blogs.nytimes.com","https://mlocal.travel.nytimes.com":"https://travel.nytimes.com","https://mlocal.up.nytimes.com":"https://up.nytimes.com","https://mlocal.video.nytimes.com":"https://video.nytimes.com","https://mlocal.well.blogs.nytimes.com":"https://well.blogs.nytimes.com","https://mlocal.wordplay.blogs.nytimes.com":"https://wordplay.blogs.nytimes.com","https://mlocal.wt.o.nytimes.com":"https://wt.o.nytimes.com"};
var mapOriginToProxy = {"http://6thfloor.blogs.nytimes.com":"http://mlocal.6thfloor.blogs.nytimes.com","http://artsbeat.blogs.nytimes.com":"http://mlocal.artsbeat.blogs.nytimes.com","http://autos.nytimes.com":"http://mlocal.autos.nytimes.com","http://beta620.nytimes.com":"http://mlocal.beta620.nytimes.com","http://bits.blogs.nytimes.com":"http://mlocal.bits.blogs.nytimes.com","http://dealbook.nytimes.com":"http://mlocal.dealbook.nytimes.com","http://dotearth.blogs.nytimes.com":"http://mlocal.dotearth.blogs.nytimes.com","http://eedition.nytimes.com":"http://mlocal.eedition.nytimes.com","http://frugaltraveler.blogs.nytimes.com":"http://mlocal.frugaltraveler.blogs.nytimes.com","http://gadgetwise.blogs.nytimes.com":"http://mlocal.gadgetwise.blogs.nytimes.com","http://global.nytimes.com":"http://mlocal.global.nytimes.com","http://graphics8.nytimes.com":"http://mlocal.graphics8.nytimes.com","http://homedelivery.nytimes.com":"http://mlocal.homedelivery.nytimes.com","http://jobmarket.nytimes.com":"http://mlocal.jobmarket.nytimes.com","http://json8.nytimes.com":"http://mlocal.json8.nytimes.com","http://krugman.blogs.nytimes.com":"http://mlocal.krugman.blogs.nytimes.com","http://latitude.blogs.nytimes.com":"http://mlocal.latitude.blogs.nytimes.com","http://lens.blogs.nytimes.com":"http://mlocal.lens.blogs.nytimes.com","http://listings.nytimes.com":"http://mlocal.listings.nytimes.com","http://markets.on.nytimes.com":"http://mlocal.markets.on.nytimes.com","http://mobile.nytimes.com":"http://mlocal.mobile.nytimes.com","http://movies.nytimes.com":"http://mlocal.movies.nytimes.com","http://myaccount.nytimes.com":"http://mlocal.myaccount.nytimes.com","http://nocera.blogs.nytimes.com":"http://mlocal.nocera.blogs.nytimes.com","http://nytimes.com":"http://mlocal.nytimes.com","http://offthedribble.blogs.nytimes.com":"http://mlocal.offthedribble.blogs.nytimes.com","http://opinionator.blogs.nytimes.com":"http://mlocal.opinionator.blogs.nytimes.com","http://placead.nytimes.com":"http://mlocal.placead.nytimes.com","http://publiceditor.blogs.nytimes.com":"http://mlocal.publiceditor.blogs.nytimes.com","http://realestate.nytimes.com":"http://mlocal.realestate.nytimes.com","http://realestateads.nytimes.com":"http://mlocal.realestateads.nytimes.com","http://spiderbites.nytimes.com":"http://mlocal.spiderbites.nytimes.com","http://takingnote.blogs.nytimes.com":"http://mlocal.takingnote.blogs.nytimes.com","http://theater.nytimes.com":"http://mlocal.theater.nytimes.com","http://thecaucus.blogs.nytimes.com":"http://mlocal.thecaucus.blogs.nytimes.com","http://thelede.blogs.nytimes.com":"http://mlocal.thelede.blogs.nytimes.com","http://timeslimited.nytimes.com":"http://mlocal.timeslimited.nytimes.com","http://timesmachine.nytimes.com":"http://mlocal.timesmachine.nytimes.com","http://tmagazine.blogs.nytimes.com":"http://mlocal.tmagazine.blogs.nytimes.com","http://travel.nytimes.com":"http://mlocal.travel.nytimes.com","http://up.nytimes.com":"http://mlocal.up.nytimes.com","http://video.nytimes.com":"http://mlocal.video.nytimes.com","http://well.blogs.nytimes.com":"http://mlocal.well.blogs.nytimes.com","http://wordplay.blogs.nytimes.com":"http://mlocal.wordplay.blogs.nytimes.com","http://wt.o.nytimes.com":"http://mlocal.wt.o.nytimes.com","http://www.nytimes.com":"http://mlocal.nytimes.com","https://6thfloor.blogs.nytimes.com":"https://mlocal.6thfloor.blogs.nytimes.com","https://artsbeat.blogs.nytimes.com":"https://mlocal.artsbeat.blogs.nytimes.com","https://autos.nytimes.com":"https://mlocal.autos.nytimes.com","https://beta620.nytimes.com":"https://mlocal.beta620.nytimes.com","https://bits.blogs.nytimes.com":"https://mlocal.bits.blogs.nytimes.com","https://dealbook.nytimes.com":"https://mlocal.dealbook.nytimes.com","https://dotearth.blogs.nytimes.com":"https://mlocal.dotearth.blogs.nytimes.com","https://eedition.nytimes.com":"https://mlocal.eedition.nytimes.com","https://frugaltraveler.blogs.nytimes.com":"https://mlocal.frugaltraveler.blogs.nytimes.com","https://gadgetwise.blogs.nytimes.com":"https://mlocal.gadgetwise.blogs.nytimes.com","https://global.nytimes.com":"https://mlocal.global.nytimes.com","https://graphics8.nytimes.com":"https://mlocal.graphics8.nytimes.com","https://homedelivery.nytimes.com":"https://mlocal.homedelivery.nytimes.com","https://jobmarket.nytimes.com":"https://mlocal.jobmarket.nytimes.com","https://json8.nytimes.com":"https://mlocal.json8.nytimes.com","https://krugman.blogs.nytimes.com":"https://mlocal.krugman.blogs.nytimes.com","https://latitude.blogs.nytimes.com":"https://mlocal.latitude.blogs.nytimes.com","https://lens.blogs.nytimes.com":"https://mlocal.lens.blogs.nytimes.com","https://listings.nytimes.com":"https://mlocal.listings.nytimes.com","https://markets.on.nytimes.com":"https://mlocal.markets.on.nytimes.com","https://mobile.nytimes.com":"https://mlocal.mobile.nytimes.com","https://movies.nytimes.com":"https://mlocal.movies.nytimes.com","https://myaccount.nytimes.com":"https://mlocal.myaccount.nytimes.com","https://nocera.blogs.nytimes.com":"https://mlocal.nocera.blogs.nytimes.com","https://nytimes.com":"https://mlocal.nytimes.com","https://offthedribble.blogs.nytimes.com":"https://mlocal.offthedribble.blogs.nytimes.com","https://opinionator.blogs.nytimes.com":"https://mlocal.opinionator.blogs.nytimes.com","https://placead.nytimes.com":"https://mlocal.placead.nytimes.com","https://publiceditor.blogs.nytimes.com":"https://mlocal.publiceditor.blogs.nytimes.com","https://realestate.nytimes.com":"https://mlocal.realestate.nytimes.com","https://realestateads.nytimes.com":"https://mlocal.realestateads.nytimes.com","https://spiderbites.nytimes.com":"https://mlocal.spiderbites.nytimes.com","https://takingnote.blogs.nytimes.com":"https://mlocal.takingnote.blogs.nytimes.com","https://theater.nytimes.com":"https://mlocal.theater.nytimes.com","https://thecaucus.blogs.nytimes.com":"https://mlocal.thecaucus.blogs.nytimes.com","https://thelede.blogs.nytimes.com":"https://mlocal.thelede.blogs.nytimes.com","https://timeslimited.nytimes.com":"https://mlocal.timeslimited.nytimes.com","https://timesmachine.nytimes.com":"https://mlocal.timesmachine.nytimes.com","https://tmagazine.blogs.nytimes.com":"https://mlocal.tmagazine.blogs.nytimes.com","https://travel.nytimes.com":"https://mlocal.travel.nytimes.com","https://up.nytimes.com":"https://mlocal.up.nytimes.com","https://video.nytimes.com":"https://mlocal.video.nytimes.com","https://well.blogs.nytimes.com":"https://mlocal.well.blogs.nytimes.com","https://wordplay.blogs.nytimes.com":"https://mlocal.wordplay.blogs.nytimes.com","https://wt.o.nytimes.com":"https://mlocal.wt.o.nytimes.com","https://www.nytimes.com":"https://mlocal.nytimes.com"};

if (typeof(mw) == "undefined") {
	window.mw = {};
}

if(typeof(mw.catch_all_domain) == "undefined") {
	mw.catch_all_domain = ".moovapp.com";
} else {
  if (mw.catch_all_domain[0] != ".") {
  	console.log("Bad catch all domain");
  }
}


function detect_catch_all(url) {
	var found_index = url.host.indexOf(mw.catch_all_domain);
	var length = url.host.length;

	if (found_index != -1 && (found_index + mw.catch_all_domain.length) == length) {
		return true;
	}
	return false;
}

function strip_catch_all(url) {
	var found_index = url.host.indexOf(mw.catch_all_domain);
	var length = url.host.length;

	url.host = url.host.slice(0, found_index);
	return url;
}

function add_catch_all(url) {
	url.host = url.host + mw.catch_all_domain;
	return url;	
}

function getParsedURL(url) {
	var elem = document.createElement("a")
	elem.href = url;
	return elem;
}

function getSchemeAndHostname(url) {
	var result = {};
	result.scheme = url.protocol;
	result.host = url.host;
	return result;
}

function getKey(url) {
	var components = getSchemeAndHostname(url);
	return components.scheme + "//" + components.host;
}

function fetch(url, map) {
	var key = getKey(url);
	var result = map[key];
	
	if (result === undefined) {
		if (typeof(mw) != 'undefined' && mw.debug == true) {
			console.log("Warning. No rule to modify host (" + key + ").")
		}
		return url.href;
	}
	
	return result + url.pathname + url.search + url.hash;
}

function detect(rawURL) {
  var properties = {
    "secure": false,
    "schema_relative": false,
    "relative": false
  };  
  properties.raw = rawURL;
  
  if (rawURL.indexOf("https://") != -1) {
    properties.secure = true;
  } else if(rawURL.indexOf("http://") == -1) {
    if (rawURL.indexOf("//") == 0) {
      properties.schema_relative = true;
    } else {
      properties.relative = true;
    }
  }
  
  return properties;
}

function denormalize(url, properties) {
  url = getParsedURL(url);
  if (properties.relative) {    
    return url.pathname + url.search + url.hash;
  } else {
    if (properties.secure) {
      return url.href.replace("http://","https://");
    } 
    if (properties.schema_relative) {
      return url.href.replace(/^https*:/, "");
    }
    
  }
  return url.href;
}

mw.proxyURLToOrigin = function(rawURL){	

	var properties = detect(rawURL);

	// Make sure it includes the host, or it will still be proxied!
	properties.relative = false;

	var url = getParsedURL(rawURL);
	var catch_all = detect_catch_all(url);

  if (catch_all) {    
	  url = strip_catch_all(url);
  }
	
	url = fetch(url, mapProxyToOrigin);
	url = denormalize(url, properties);

	return url;
}

mw.originURLToProxy = function(rawURL){

	var properties = detect(rawURL);
	var url = getParsedURL(rawURL);
	var catch_all = detect_catch_all(url);

  if (catch_all) {    
	  url = strip_catch_all(url);
  }

  url = getParsedURL(fetch(url, mapOriginToProxy));
  var globalLocation = getParsedURL(window.location.href);
  if (detect_catch_all(globalLocation)) {
      url = add_catch_all(url);
  }

	url = denormalize(url.href, properties);
	
	return url;
}

}());
